# These prompts are to support tool calling. Currently not used in the main flow or via any configs
# The current generation of LLM is too unreliable for this task.
# Onyx retrieval call as a tool option
DANSWER_TOOL_NAME = "Current Search"
DANSWER_TOOL_DESCRIPTION = (
    "Инструмент поиска для получения фактической информации, "
    "технических данных и отчётов по геологии, ресурсам, стандартам и горно-экономическим вопросам, "
    "включая актуальные и специализированные источники."
)


# Tool calling format inspired from LangChain
TOOL_TEMPLATE = """
TOOLS 
------
Ты МОЖЕШЬ использовать инструменты для поиска информации, если это необходимо для ответа \
на исходный запрос пользователя. 
 
ВАЖНО: 
— ты НЕ начинаешь поиск автоматически; 
— сначала классифицируешь запрос (концептуальный / объектный / стандарт / смешанный); 
— поиск ОБЯЗАТЕЛЕН только для объектных, стандартных и смешанных запросов; 
— если поиск не требуется, ты отвечаешь напрямую. 
 
Доступные инструменты: 
{tool_overviews} 
 
RESPONSE FORMAT INSTRUCTIONS 
----------------------------
Ты ОБЯЗАН выбрать ТОЛЬКО ОДИН из двух форматов ответа: 
 
**Вариант 1 (использование инструмента):** 
Используй этот вариант, если для корректного ответа необходимы внешние данные. 
Ответ должен быть представлен ИСКЛЮЧИТЕЛЬНО в виде Markdown-кода \
со следующим JSON-схемой: 
 
```json
{{
    "action": string,  \\ действие, строго одно из: {tool_names}
    "action_input": string  \\ входные данные: короткий поисковый запрос,
                            \\ содержащий только ключевые сущности (3–7 токенов),
                            \\ без вопросительных форм и полных предложений
}}
``` 
 
**Вариант 2 (прямой ответ пользователю):** 
Используй этот вариант, если ответ может быть дан на основе имеющихся знаний \
без обращения к инструментам. 
 
```json
{{
    "action": "Final Answer",
    "action_input": string \\ финальный аналитический ответ пользователю
}}
``` 
 
Любое отклонение от формата считается ошибкой.
"""

# For the case where the user has not configured any tools to call, but still using the tool-flow
# expected format
TOOL_LESS_PROMPT = """
Если инструменты недоступны или не сконфигурированы, \
ты ОБЯЗАН ответить напрямую, строго в виде Markdown-кода \
со следующим JSON-форматом: 
 
```json
{{
    "action": "Final Answer",
    "action_input": string  \\ структурированный аналитический ответ пользователю
}}
``` 
 
Любой дополнительный текст вне JSON запрещён.
"""

# Second part of the prompt to include the user query
USER_INPUT = """
USER'S INPUT 
--------------------
Ниже приведён запрос пользователя. 
 
ВАЖНО: 
— если запрос объектный (месторождение, проект, район, отчёт, стандарт), \
ты обязан инициировать поиск; 
— если запрос концептуальный или методологический, \
отвечай без использования инструментов; 
— всегда соблюдай аналитический и отчётный стиль. 
 
(Помни: твой ответ ДОЛЖЕН быть Markdown-кодом с JSON-блоком, \
содержащим РОВНО одно действие, и НИЧЕГО кроме него.) 
 
{user_input}
"""

# After the tool call, this is the following message to get a final answer
# Tools are not chained currently, the system must provide an answer after calling a tool
TOOL_FOLLOWUP = """
TOOL RESPONSE: 
---------------------
{tool_output}

USER'S INPUT 
--------------------
На основе приведённого ответа инструмента сформулируй финальный аналитический ответ. 
 
ВАЖНО: 
— если ты используешь информацию из TOOL RESPONSE, ты обязан явно опереться на неё, \
но НЕ упоминать названия инструментов; 
— если TOOL RESPONSE нерелевантен или недостаточен, полностью проигнорируй его; 
— не компенсируй отсутствие данных предположениями. 
 w
{optional_reminder} {hint} 
 
ОБЯЗАТЕЛЬНО: 
Ответ должен быть оформлен ТОЛЬКО в виде Markdown code snippet \
с JSON-объектом с одним действием. 
"""

# If no tools were used, but retrieval is enabled, then follow up with this message to get the final answer
TOOL_LESS_FOLLOWUP = """
Ниже приведены документы, которые могут быть использованы при ответе. 
Игнорируй любые документы, не относящиеся напрямую к аналитическому запросу. 
 
CONTEXT DOCUMENTS: 
---------------------
{context_str} 
 
FINAL QUERY: 
---------------------
{user_query} 
 
ТРЕБОВАНИЯ К ОТВЕТУ: 
— строго аналитический стиль; 
— явная фиксация неопределённостей и ограничений данных; 
— отсутствие экономических выводов без геологических оснований. 
 
{hint_text}
"""